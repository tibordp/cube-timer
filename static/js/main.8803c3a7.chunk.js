(this["webpackJsonpcube-timer"]=this["webpackJsonpcube-timer"]||[]).push([[0],{106:function(e,t,n){"use strict";n.r(t);var r,a=n(2),c=n(0),i=n.n(c),s=n(15),o=n.n(s),u=(n(78),n(56)),l=n(10),d=n(35),j=n.n(d),f=n(122),v=(n(79),n(12)),O=n.n(v),b=n(27),h="eb0e77c3-af14-4b7f-ac80-d3631dc386ac";!function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED"}(r||(r={}));var m=n(124),p=n(127),N=n(125),x=n(128),C=n(126),E=n(69),g=n.n(E),y=n(46),T=n.n(y),D=n(67),I=n.n(D),k=n(68),S=n.n(k);function w(e,t){var n=t.state;return e!==r.CONNECTED?"#f5f2f0":n>=10&&n<20?"#f22d54":n>=20&&n<30?"#41c248":"#f5f2f0"}function F(e){return-1===e?"DNF":new Date(Math.max(0,e)).toISOString().substr(14,9).replace(/^[0:]+(?!\.)/,"")}function A(){var e=i.a.useState(0),t=Object(l.a)(e,2),n=t[0],r=t[1],c=i.a.useRef(),s=i.a.useRef(),o=function e(t){if(void 0!==s.current){var n=t-s.current;r((function(e){return e+n}))}s.current=t,c.current=requestAnimationFrame(e)};return i.a.useEffect((function(){return c.current=requestAnimationFrame(o),function(){return cancelAnimationFrame(c.current)}}),[]),Object(a.jsx)("span",{className:"duration",children:F(n)})}function L(e){var t=e.timerState,n=t.state,r=t.duration,c=n>=20&&n<30,i=n>=10&&n<20,s=!c&&!i;return Object(a.jsxs)(a.Fragment,{children:[s&&0!==r&&Object(a.jsx)("span",{className:"duration",children:F(r)}),s&&0===r&&Object(a.jsx)("span",{className:"status",children:"Ready!"}),c&&Object(a.jsx)(A,{}),i&&Object(a.jsx)("span",{className:"status",children:"Inspection"})]})}function G(e,t){switch(t.action){case"push":if(e[t.timerState.epoch]===t.timerState.duration)return e;var n=Object(u.a)({},e);return 0!==t.timerState.duration?n[t.timerState.epoch]=t.timerState.duration:delete n[t.timerState.epoch],n;case"delete":var r=Object(u.a)({},e);return delete r[t.epoch],r;case"clear":return{};case"initialize":return t.initialData}}var _=Object(f.a)((function(e){return{stats:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-around",padding:0},statsItem:{textAlign:"center",width:"initial"},results:{overflowY:"scroll"},paper:{display:"flex",flexDirection:"column",maxHeight:"35vh",width:"20em",maxWidth:"90vw"}}}));var q=function(){var e=function(){var e=i.a.useState(r.NOT_CONNECTED),t=Object(l.a)(e,2),n=t[0],a=t[1],c=i.a.useState(null),s=Object(l.a)(c,2),o=s[0],u=s[1],d=i.a.useState({state:0,epoch:0,duration:0}),j=Object(l.a)(d,2),f=j[0],v=j[1],m=function(){var e=Object(b.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(r.CONNECTING),e.prev=1,e.next=4,navigator.bluetooth.requestDevice({filters:[{services:[h]}]});case 4:t=e.sent,u(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),a(r.NOT_CONNECTED);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(b.a)(O.a.mark((function e(t){var n,c,i,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a(r.CONNECTING),e.next=4,null===(n=t.gatt)||void 0===n?void 0:n.connect();case 4:return e.next=6,null===(c=t.gatt)||void 0===c?void 0:c.getPrimaryService(h);case 6:return i=e.sent,e.next=9,null===i||void 0===i?void 0:i.getCharacteristic("eb0e77c3-af14-4b7f-ac80-d3631dc386ad");case 9:return(s=e.sent).oncharacteristicvaluechanged=function(){var e=s.value.getUint32(0,!0),t=s.value.getUint32(4,!0),n=s.value.byteLength>4?s.value.getInt32(8,!0):0;v({state:e,epoch:t,duration:n})},e.next=13,null===s||void 0===s?void 0:s.readValue();case 13:null===s||void 0===s||s.startNotifications(),a(r.CONNECTED),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.error(e.t0),a(r.FAILED);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}();function N(){p(this)}var x=function(){var e=Object(b.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.useEffect((function(){return o?(p(o).then((function(){return o.addEventListener("gattserverdisconnected",N)})),function(){var e;o.removeEventListener("gattserverdisconnected",N),null===(e=o.gatt)||void 0===e||e.disconnect()}):(a(r.NOT_CONNECTED),function(){})}),[o]),{connect:m,disconnect:x,connectionState:n,timerState:f}}(),t=e.connect,n=e.disconnect,c=e.connectionState,s=e.timerState,o=_(),u=i.a.useReducer(G,[]),d=Object(l.a)(u,2),f=d[0],v=d[1];!function(e){var t=i.a.useState(null),n=Object(l.a)(t,2),r=n[0],a=n[1];i.a.useEffect((function(){return e?(function(){var e=Object(b.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.wakeLock.request("screen");case 3:t=e.sent,console.info("We have the wake lock."),a(t),t.addEventListener("release",(function(){console.info("We no longer have the wake lock."),a(null)})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}()(),function(){null===r||void 0===r||r.release()}):function(){}}),[e])}(c===r.CONNECTED||c===r.CONNECTING),i.a.useEffect((function(){v({action:"push",timerState:s})}),[s]);var E=i.a.useMemo((function(){return function(e){var t=Object.entries(e).map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];return[parseInt(n),r]})).sort((function(e,t){return t[0]-e[0]})),n=t.map((function(e){var t=Object(l.a)(e,2),n=(t[0],t[1]);return-1===n?1/0:n})),r=n.length>0?n.reduce((function(e,t){return Math.min(e,t)}),1/0):void 0,a=n.slice(0,5).sort((function(e,t){return e-t})),c=5===a.length?a.slice(1,4).reduce((function(e,t){return e+t}),0)/3:void 0,i=n.slice(0,12).sort((function(e,t){return e-t})),s=12===i.length?i.slice(1,11).reduce((function(e,t){return e+t}),0)/10:void 0;return{orderedHistory:t,best:r===1/0?-1:r,avg5:c===1/0?-1:c,avg12:s===1/0?-1:s}}(f)}),[f]),y=E.orderedHistory,D=E.best,k=E.avg5,A=E.avg12;return Object(a.jsxs)("div",{className:"background",style:{backgroundColor:w(c,s)},children:[Object(a.jsx)("div",{className:"topBar",children:c===r.CONNECTED&&Object(a.jsx)(j.a,{startIcon:Object(a.jsx)(I.a,{}),variant:"contained",color:"default",onClick:n,children:"Disconnect"})}),Object(a.jsxs)("div",{className:"main",children:[Object(a.jsxs)("div",{className:"mainInner",children:[c===r.FAILED&&Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(j.a,{startIcon:Object(a.jsx)(T.a,{}),onClick:t,children:"Connect"})}),c===r.NOT_CONNECTED&&Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(j.a,{startIcon:Object(a.jsx)(T.a,{}),variant:"contained",color:"primary",onClick:t,children:"Connect"})}),c===r.CONNECTING&&Object(a.jsx)(a.Fragment,{children:Object(a.jsx)(j.a,{startIcon:Object(a.jsx)(T.a,{}),variant:"contained",disabled:!0,color:"primary",onClick:t,children:"Connecting..."})}),c===r.CONNECTED&&Object(a.jsx)(L,{timerState:s})]}),Object(a.jsxs)(S.a,{className:o.paper,children:[Object(a.jsxs)(m.a,{className:o.stats,children:[Object(a.jsx)(p.a,{className:o.statsItem,dense:!0,children:Object(a.jsx)(x.a,{primary:"Best",secondary:void 0!==D?F(D):"-"})}),Object(a.jsx)(p.a,{className:o.statsItem,dense:!0,children:Object(a.jsx)(x.a,{primary:"Avg 5",secondary:void 0!==k?F(k):"-"})}),Object(a.jsx)(p.a,{className:o.statsItem,dense:!0,children:Object(a.jsx)(x.a,{primary:"Avg 12",secondary:void 0!==A?F(A):"-"})})]}),Object(a.jsxs)(m.a,{className:o.results,children:[y.map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1],c="list-label-".concat(n);return Object(a.jsxs)(p.a,{role:void 0,dense:!0,children:[Object(a.jsx)(x.a,{id:c,primary:F(r)}),Object(a.jsx)(N.a,{children:Object(a.jsx)(C.a,{edge:"end","aria-label":"comments",children:Object(a.jsx)(g.a,{onClick:function(){return v({action:"delete",epoch:n})}})})})]},n)})),Object(a.jsx)(p.a,{role:void 0,dense:!0,disabled:0===y.length,onClick:function(){return v({action:"clear"})},button:!0,children:Object(a.jsx)(x.a,{primary:"Clear history"})})]})]})]})]})};o.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(q,{})}),document.getElementById("root"))},78:function(e,t,n){},79:function(e,t,n){}},[[106,1,2]]]);
//# sourceMappingURL=main.8803c3a7.chunk.js.map