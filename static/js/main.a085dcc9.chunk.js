(this["webpackJsonpcube-timer"]=this["webpackJsonpcube-timer"]||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var r,c=n(2),a=n(0),i=n.n(a),s=n(15),o=n.n(s),u=(n(76),n(54)),l=n(10),d=n(35),j=n.n(d),v=(n(77),n(12)),f=n.n(v),O=n(27),b="eb0e77c3-af14-4b7f-ac80-d3631dc386ac";!function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED"}(r||(r={}));var h=n(121),p=n(124),N=n(122),m=n(125),x=n(123),C=n(67),E=n.n(C),g=n(45),T=n.n(g),y=n(68),D=n.n(y),S=n(66),k=n.n(S);function I(e){return-1===e?"DNF":new Date(Math.max(0,e)).toISOString().substr(14,9).replace(/^[0:]+(?!\.)/,"")}function w(){var e=i.a.useState(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=i.a.useRef(),s=i.a.useRef(),o=function e(t){if(void 0!==s.current){var n=t-s.current;r((function(e){return e+n}))}s.current=t,a.current=requestAnimationFrame(e)};return i.a.useEffect((function(){return a.current=requestAnimationFrame(o),function(){return cancelAnimationFrame(a.current)}}),[]),Object(c.jsx)("span",{className:"running",children:I(n)})}function F(e){var t=e.timerState,n=t.state,r=t.duration,a=n>=20&&n<30,i=n>=10&&n<20,s=!a&&!i;return Object(c.jsxs)(c.Fragment,{children:[s&&0!==r&&Object(c.jsx)(c.Fragment,{children:I(r)}),s&&0===r&&Object(c.jsx)(c.Fragment,{children:"Ready!"}),a&&Object(c.jsx)(w,{}),i&&Object(c.jsx)("span",{className:"inspection",children:"Inspection"})]})}function A(e,t){switch(t.action){case"push":if(e[t.timerState.epoch]===t.timerState.duration)return e;var n=Object(u.a)({},e);return 0!==t.timerState.duration?n[t.timerState.epoch]=t.timerState.duration:delete n[t.timerState.epoch],n;case"delete":var r=Object(u.a)({},e);return delete r[t.epoch],r;case"clear":return{};case"initialize":return t.initialData}}var L=function(){var e=function(){var e=i.a.useState(r.NOT_CONNECTED),t=Object(l.a)(e,2),n=t[0],c=t[1],a=i.a.useState(null),s=Object(l.a)(a,2),o=s[0],u=s[1],d=i.a.useState({state:0,epoch:0,duration:0}),j=Object(l.a)(d,2),v=j[0],h=j[1],p=function(){var e=Object(O.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(r.CONNECTING),e.prev=1,e.next=4,navigator.bluetooth.requestDevice({filters:[{services:[b]}]});case 4:t=e.sent,u(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),c(r.NOT_CONNECTED);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(O.a)(f.a.mark((function e(t){var n,a,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c(r.CONNECTING),e.next=4,null===(n=t.gatt)||void 0===n?void 0:n.connect();case 4:return e.next=6,null===(a=t.gatt)||void 0===a?void 0:a.getPrimaryService(b);case 6:return i=e.sent,e.next=9,null===i||void 0===i?void 0:i.getCharacteristic("eb0e77c3-af14-4b7f-ac80-d3631dc386ad");case 9:return(s=e.sent).oncharacteristicvaluechanged=function(){var e=s.value.getUint32(0,!0),t=s.value.getUint32(4,!0),n=s.value.byteLength>4?s.value.getInt32(8,!0):0;h({state:e,epoch:t,duration:n})},e.next=13,null===s||void 0===s?void 0:s.readValue();case 13:null===s||void 0===s||s.startNotifications(),c(r.CONNECTED),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(0),console.error(e.t0),c(r.FAILED);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}();function m(){N(this)}var x=function(){var e=Object(O.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.a.useEffect((function(){return o?(N(o).then((function(){return o.addEventListener("gattserverdisconnected",m)})),function(){var e;o.removeEventListener("gattserverdisconnected",m),null===(e=o.gatt)||void 0===e||e.disconnect()}):(c(r.NOT_CONNECTED),function(){})}),[o]),{connect:p,disconnect:x,connectionState:n,timerState:v}}(),t=e.connect,n=e.disconnect,a=e.connectionState,s=e.timerState,o=i.a.useReducer(A,[]),u=Object(l.a)(o,2),d=u[0],v=u[1];!function(e){var t=i.a.useState(null),n=Object(l.a)(t,2),r=n[0],c=n[1];i.a.useEffect((function(){return e?(function(){var e=Object(O.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.wakeLock.request("screen");case 3:t=e.sent,console.info("We have the wake lock."),c(t),t.addEventListener("release",(function(){console.info("We no longer have the wake lock."),c(null)})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}()(),function(){null===r||void 0===r||r.release()}):function(){}}),[e])}(a===r.CONNECTED||a===r.CONNECTING),i.a.useEffect((function(){v({action:"push",timerState:s})}),[s]);var C=i.a.useMemo((function(){return function(e){var t=Object.entries(e).map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];return[parseInt(n),r]})).sort((function(e,t){return t[0]-e[0]})),n=t.map((function(e){var t=Object(l.a)(e,2),n=(t[0],t[1]);return-1===n?1/0:n})),r=n.length>0?n.reduce((function(e,t){return Math.min(e,t)}),1/0):void 0,c=n.slice(0,5).sort((function(e,t){return e-t})),a=5===c.length?c.slice(1,4).reduce((function(e,t){return e+t}),0)/3:void 0,i=n.slice(0,12).sort((function(e,t){return e-t})),s=12===i.length?i.slice(1,11).reduce((function(e,t){return e+t}),0)/10:void 0;return{orderedHistory:t,best:r===1/0?-1:r,avg5:a===1/0?-1:a,avg12:s===1/0?-1:s}}(d)}),[d]),g=C.orderedHistory,y=C.best,S=C.avg5,w=C.avg12;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:"statusDisplay",children:a===r.CONNECTED&&Object(c.jsx)(F,{timerState:s})}),Object(c.jsxs)(k.a,{className:"card",children:[Object(c.jsxs)(h.a,{className:"stats",children:[Object(c.jsx)(p.a,{dense:!0,children:Object(c.jsx)(m.a,{primary:"Best",secondary:void 0!==y?I(y):"-"})}),Object(c.jsx)(p.a,{dense:!0,children:Object(c.jsx)(m.a,{primary:"Avg 5",secondary:void 0!==S?I(S):"-"})}),Object(c.jsx)(p.a,{dense:!0,children:Object(c.jsx)(m.a,{primary:"Avg 12",secondary:void 0!==w?I(w):"-"})})]}),Object(c.jsxs)(h.a,{className:"results",children:[g.map((function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1],a="list-label-".concat(n);return Object(c.jsxs)(p.a,{role:void 0,dense:!0,children:[Object(c.jsx)(m.a,{id:a,primary:I(r)}),Object(c.jsx)(N.a,{children:Object(c.jsx)(x.a,{edge:"end","aria-label":"comments",children:Object(c.jsx)(E.a,{onClick:function(){return v({action:"delete",epoch:n})}})})})]},n)})),Object(c.jsx)(p.a,{role:void 0,dense:!0,disabled:0===g.length,onClick:function(){return v({action:"clear"})},button:!0,children:Object(c.jsx)(m.a,{primary:"Clear history"})})]})]}),a===r.FAILED&&Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(j.a,{startIcon:Object(c.jsx)(T.a,{}),onClick:t,children:"Connect"})}),a===r.NOT_CONNECTED&&Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(j.a,{startIcon:Object(c.jsx)(T.a,{}),variant:"contained",color:"primary",onClick:t,children:"Connect"})}),a===r.CONNECTING&&Object(c.jsx)(c.Fragment,{children:Object(c.jsx)(j.a,{startIcon:Object(c.jsx)(T.a,{}),variant:"contained",disabled:!0,color:"primary",onClick:t,children:"Connecting..."})}),a===r.CONNECTED&&Object(c.jsx)(j.a,{startIcon:Object(c.jsx)(D.a,{}),variant:"contained",color:"default",onClick:n,children:"Disconnect"})]})};o.a.render(Object(c.jsx)(i.a.StrictMode,{children:Object(c.jsx)(L,{})}),document.getElementById("root"))},76:function(e,t,n){},77:function(e,t,n){}},[[104,1,2]]]);
//# sourceMappingURL=main.a085dcc9.chunk.js.map