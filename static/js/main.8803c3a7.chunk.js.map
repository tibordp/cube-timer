{"version":3,"sources":["bluetooth.ts","App.tsx","wakeLock.ts","index.tsx"],"names":["ConnectionState","CUBE_TIME_UUID","getBackgroundColor","connectionState","timerState","state","CONNECTED","formatDuration","milliseconds","Date","Math","max","toISOString","substr","replace","FakeRunTime","React","useState","count","setCount","rafRef","useRef","previousTimeRef","animate","time","undefined","current","deltaTime","prevCount","requestAnimationFrame","useEffect","cancelAnimationFrame","className","CubeDisplay","duration","isRunning","isInspection","isDefaultState","reducer","action","epoch","newState","initialData","useStyles","makeStyles","theme","stats","display","flexDirection","flexWrap","justifyContent","padding","statsItem","textAlign","width","results","overflowY","paper","maxHeight","maxWidth","App","NOT_CONNECTED","setConnectionState","device","setDevice","setTimerState","connect","a","CONNECTING","navigator","bluetooth","requestDevice","filters","services","connectGatt","gatt","getPrimaryService","service","getCharacteristic","characteristic","oncharacteristicvaluechanged","value","getUint32","byteLength","getInt32","readValue","startNotifications","console","error","FAILED","reconnect","this","disconnect","then","addEventListener","removeEventListener","useBluetooth","classes","useReducer","history","dispatch","enabled","sentinel","setSentinel","wakeLock","request","info","acquire","release","useWakeLock","useMemo","orderedHistory","Object","entries","map","b","parseInt","sort","values","Infinity","best","length","reduce","min","avg5results","slice","avg5","avg12results","avg12","getHistoryData","style","backgroundColor","startIcon","variant","color","onClick","disabled","List","ListItem","dense","ListItemText","primary","secondary","labelId","role","id","ListItemSecondaryAction","IconButton","edge","aria-label","button","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8803c3a7.chunk.js","sourcesContent":["import React from \"react\";\n\nconst CUBE_TIME_UUID = \"eb0e77c3-af14-4b7f-ac80-d3631dc386ac\";\nconst CHARACTERISTIC_UUID = \"eb0e77c3-af14-4b7f-ac80-d3631dc386ad\";\n\nexport interface TimerState {\n  state: number;\n  epoch: number;\n  duration: number;\n}\n\nexport enum ConnectionState {\n  NOT_CONNECTED,\n  CONNECTING,\n  CONNECTED,\n  FAILED,\n}\n\nexport interface UseBluetoothResult {\n  connect(): void;\n  disconnect(): void;\n  connectionState: ConnectionState;\n  timerState: TimerState;\n}\n\nexport function useBluetooth(): UseBluetoothResult {\n  const [connectionState, setConnectionState] = React.useState<ConnectionState>(ConnectionState.NOT_CONNECTED);\n  const [device, setDevice] = React.useState<BluetoothDevice | null>(null);\n  const [timerState, setTimerState] = React.useState<TimerState>({\n    state: 0,\n    epoch: 0,\n    duration: 0,\n  });\n\n  const connect = async () => {\n    setConnectionState(ConnectionState.CONNECTING);\n    try {\n        const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: [CUBE_TIME_UUID] }],\n        });\n        setDevice(device);\n    } catch (e) {\n        // User has likely canceled the dialog, or didn't find \n        // the device, so we don't treat this as error.\n        setConnectionState(ConnectionState.NOT_CONNECTED);\n    }\n  };\n\n  const connectGatt = async (device: BluetoothDevice) => {\n    try {\n      setConnectionState(ConnectionState.CONNECTING);\n      await device.gatt?.connect();\n      const service = await device.gatt?.getPrimaryService(CUBE_TIME_UUID);\n      const characteristic = await service?.getCharacteristic(\n        CHARACTERISTIC_UUID\n      );\n      characteristic!.oncharacteristicvaluechanged = () => {\n        const state = characteristic!.value!.getUint32(0, true);\n        const epoch = characteristic!.value!.getUint32(4, true);\n        const duration =\n          characteristic!.value!.byteLength > 4\n            ? characteristic!.value!.getInt32(8, true)\n            : 0;\n\n        setTimerState({ state, epoch, duration });\n      };\n      await characteristic?.readValue();\n      characteristic?.startNotifications();\n      setConnectionState(ConnectionState.CONNECTED);\n    } catch (e) {\n      console.error(e);\n      setConnectionState(ConnectionState.FAILED);\n    }\n  };\n\n  function reconnect(this: BluetoothDevice)  {\n    connectGatt(this);\n  }\n\n  const disconnect = async () => {\n    setDevice(null);\n  };\n\n  React.useEffect(() => {\n    if (!device) {\n      setConnectionState(ConnectionState.NOT_CONNECTED);\n      return () => {};\n    }\n    \n    connectGatt(device)\n      .then(() => device.addEventListener(\"gattserverdisconnected\", reconnect));\n\n    return () => {\n      device.removeEventListener(\"gattserverdisconnected\", reconnect);\n      device.gatt?.disconnect();\n    };\n  }, [device]);\n\n  return {\n    connect,\n    disconnect,\n    connectionState,\n    timerState,\n  };\n}\n","\nimport Button from \"@material-ui/core/Button/Button\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport React from \"react\";\nimport \"./App.css\";\nimport { ConnectionState, TimerState, useBluetooth } from \"./bluetooth\";\nimport { useWakeLock } from \"./wakeLock\";\n\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemSecondaryAction from \"@material-ui/core/ListItemSecondaryAction\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport BluetoothIcon from \"@material-ui/icons/Bluetooth\";\nimport BluetoothDisabledIcon from \"@material-ui/icons/BluetoothDisabled\";\nimport Card from \"@material-ui/core/Card/Card\";\n\nfunction getBackgroundColor(\n  connectionState: ConnectionState,\n  timerState: TimerState\n) {\n  const { state } = timerState;\n  if (connectionState !== ConnectionState.CONNECTED) return \"#f5f2f0\";\n  if (state >= 10 && state < 20) return \"#f22d54\";\n  if (state >= 20 && state < 30) return \"#41c248\";\n\n  return \"#f5f2f0\";\n}\n\nexport function formatDuration(milliseconds: number): string {\n  if (milliseconds === -1) {\n    return \"DNF\";\n  }\n  return new Date(Math.max(0, milliseconds))\n    .toISOString()\n    .substr(14, 9)\n    .replace(/^[0:]+(?!\\.)/, \"\");\n}\n\n/**\n * While the timer is running, the device does not send anything via Bluetooth,\n * so we fake the running time display locally. Once the timer is stopped, the\n * correct time from the device will be displayed.\n */\nfunction FakeRunTime() {\n  const [count, setCount] = React.useState(0);\n\n  const rafRef = React.useRef<number>();\n  const previousTimeRef = React.useRef<number>();\n\n  const animate = (time: number) => {\n    if (previousTimeRef.current !== undefined) {\n      const deltaTime = time - previousTimeRef.current;\n      setCount((prevCount) => prevCount + deltaTime);\n    }\n    previousTimeRef.current = time;\n    rafRef.current = requestAnimationFrame(animate);\n  };\n\n  React.useEffect(() => {\n    rafRef.current = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(rafRef.current!);\n  }, []);\n\n  return <span className=\"duration\">{formatDuration(count)}</span>;\n}\n\ninterface CubeDisplayProps {\n  timerState: TimerState;\n}\n\nfunction CubeDisplay({ timerState }: CubeDisplayProps) {\n  const { state, duration } = timerState;\n  const isRunning = state >= 20 && state < 30;\n  const isInspection = state >= 10 && state < 20;\n  const isDefaultState = !isRunning && !isInspection;\n\n  return (\n    <>\n      {isDefaultState && duration !== 0 && (\n        <span className=\"duration\">{formatDuration(duration)}</span>\n      )}\n      {isDefaultState && duration === 0 && (\n        <span className=\"status\">Ready!</span>\n      )}\n      {isRunning && <FakeRunTime />}\n      {isInspection && <span className=\"status\">Inspection</span>}\n    </>\n  );\n}\n\ninterface HistoryAction {\n  action: \"push\" | \"delete\" | \"clear\" | \"initialize\";\n  epoch?: number;\n  timerState?: TimerState;\n  initialData?: Record<number, number>;\n}\n\nfunction reducer(\n  state: Record<number, number>,\n  action: HistoryAction\n): Record<number, number> {\n  switch (action.action) {\n    case \"push\": {\n      if (state[action.timerState!.epoch] === action.timerState!.duration)\n        return state;\n      const newState = { ...state };\n      if (action.timerState!.duration !== 0) {\n        newState[action.timerState!.epoch] = action.timerState!.duration;\n      } else {\n        delete newState[action.timerState!.epoch];\n      }\n      return newState;\n    }\n    case \"delete\": {\n      const newState = { ...state };\n      delete newState[action.epoch!];\n      return newState;\n    }\n    case \"clear\":\n      return {};\n    case \"initialize\":\n      return action.initialData!;\n  }\n}\n\nconst useStyles = makeStyles((theme) => ({\n  stats: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    flexWrap: \"wrap\",\n    justifyContent: \"space-around\",\n    padding: 0,\n  },\n  statsItem: {\n    textAlign: \"center\",\n    width: \"initial\",\n  },\n  results: {\n    overflowY: \"scroll\",\n  },\n  paper: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    maxHeight: \"35vh\",\n    width: \"20em\",\n    maxWidth: \"90vw\",\n  },\n}));\n\ninterface HistoryData {\n  orderedHistory: [number, number][],\n  best?: number;\n  avg5?: number;\n  avg12?: number;\n}\n\nfunction getHistoryData(history: Record<number, number>): HistoryData {\n  const orderedHistory = Object.entries(history)\n    .map(([a, b]) => [parseInt(a), b])\n    .sort((a, b) => b[0] - a[0]);\n\n  const values = orderedHistory.map(([a, b]) => (b === -1 ? Infinity : b));\n  const best =\n  values.length > 0\n      ? values.reduce((a, b) => Math.min(a, b), Infinity)\n      : undefined;\n  const avg5results = values.slice(0, 5).sort((a, b) => a - b);\n  const avg5 =\n    avg5results.length === 5\n      ? avg5results.slice(1, 4).reduce((a, b) => a + b, 0) / 3\n      : undefined;\n  const avg12results = values.slice(0, 12).sort((a, b) => a - b);\n  const avg12 =\n    avg12results.length === 12\n      ? avg12results.slice(1, 11).reduce((a, b) => a + b, 0) / 10\n      : undefined;\n\n  return {\n    orderedHistory: orderedHistory as [number, number][],\n    best: best === Infinity ? -1 : best,\n    avg5: avg5 === Infinity ? -1 : avg5,\n    avg12: avg12 === Infinity ? -1 : avg12,\n  };\n}\n\nfunction App() {\n  const { connect, disconnect, connectionState, timerState } = useBluetooth();\n  const classes = useStyles();\n\n  const [history, dispatch] = React.useReducer(reducer, []);\n  const hasWakeLock = useWakeLock(\n    connectionState === ConnectionState.CONNECTED ||\n      connectionState === ConnectionState.CONNECTING\n  );\n\n  React.useEffect(() => {\n    dispatch({ action: \"push\", timerState });\n  }, [timerState]);\n\n  const { orderedHistory, best, avg5, avg12 } = React.useMemo(() => getHistoryData(history), [history]);\n\n  return (\n    <div\n      className=\"background\"\n      style={{\n        backgroundColor: getBackgroundColor(connectionState, timerState),\n      }}\n    >\n      <div className=\"topBar\">\n        {connectionState === ConnectionState.CONNECTED && (\n          <Button\n            startIcon={<BluetoothDisabledIcon />}\n            variant=\"contained\"\n            color=\"default\"\n            onClick={disconnect}\n          >\n            Disconnect\n          </Button>\n        )}\n      </div>\n      <div className=\"main\">\n        <div className=\"mainInner\">\n          {connectionState === ConnectionState.FAILED && (\n            <>\n              <Button startIcon={<BluetoothIcon />} onClick={connect}>\n                Connect\n              </Button>\n            </>\n          )}\n          {connectionState === ConnectionState.NOT_CONNECTED && (\n            <>\n              <Button\n                startIcon={<BluetoothIcon />}\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={connect}\n              >\n                Connect\n              </Button>\n            </>\n          )}\n          {connectionState === ConnectionState.CONNECTING && (\n            <>\n              <Button\n                startIcon={<BluetoothIcon />}\n                variant=\"contained\"\n                disabled\n                color=\"primary\"\n                onClick={connect}\n              >\n                Connecting...\n              </Button>\n            </>\n          )}\n          {connectionState === ConnectionState.CONNECTED && (\n            <CubeDisplay timerState={timerState} />\n          )}\n        </div>\n        <Card className={classes.paper}>\n          <List className={classes.stats}>\n            <ListItem className={classes.statsItem} dense>\n              <ListItemText\n                primary=\"Best\"\n                secondary={best !== undefined ? formatDuration(best) : \"-\"}\n              />\n            </ListItem>\n            <ListItem className={classes.statsItem} dense>\n              <ListItemText\n                primary=\"Avg 5\"\n                secondary={avg5 !== undefined ? formatDuration(avg5) : \"-\"}\n              />\n            </ListItem>\n            <ListItem className={classes.statsItem} dense>\n              <ListItemText\n                primary=\"Avg 12\"\n                secondary={avg12 !== undefined ? formatDuration(avg12) : \"-\"}\n              />\n            </ListItem>\n          </List>\n\n          <List className={classes.results}>\n            {orderedHistory.map(([epoch, value]) => {\n              const labelId = `list-label-${epoch}`;\n\n              return (\n                <ListItem key={epoch} role={undefined} dense>\n                  <ListItemText id={labelId} primary={formatDuration(value)} />\n                  <ListItemSecondaryAction>\n                    <IconButton edge=\"end\" aria-label=\"comments\">\n                      <DeleteIcon\n                        onClick={() => dispatch({ action: \"delete\", epoch })}\n                      />\n                    </IconButton>\n                  </ListItemSecondaryAction>\n                </ListItem>\n              );\n            })}\n            <ListItem\n              role={undefined}\n              dense\n              disabled={orderedHistory.length === 0}\n              onClick={() => dispatch({ action: \"clear\" })}\n              button\n            >\n              <ListItemText primary=\"Clear history\" />\n            </ListItem>\n          </List>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\n\nexport function useWakeLock(enabled: boolean): boolean {\n    const [sentinel, setSentinel] = React.useState<WakeLockSentinel | null>(null);\n\n    React.useEffect(() => {\n        if (!enabled) {\n            return () => {};\n        }\n\n        const acquire = async () => {\n            try {\n                const sentinel = await navigator.wakeLock.request(\"screen\");\n                console.info(\"We have the wake lock.\");\n                setSentinel(sentinel);\n                sentinel.addEventListener(\"release\", () => {\n                    console.info(\"We no longer have the wake lock.\");\n                    setSentinel(null);\n                });\n            } catch(e) {\n                console.error(e);\n            }\n        };\n        acquire();\n\n        return () => {\n            sentinel?.release();\n        }\n    }, [enabled]);\n\n    return sentinel !== null;\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}